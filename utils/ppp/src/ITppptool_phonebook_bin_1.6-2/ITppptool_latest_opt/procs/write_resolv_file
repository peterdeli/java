proc write_resolv_file { account_name } {

	global env ipaddr_len
	set domain_len 0

	puts "write_resolv_file $account_name"
	global accounts	env
	# get account	
	set list_name [list $account_name]
	set resolv_file $accounts($list_name,resolv_file)
	if { [string length $resolv_file] < 1 } {
		# create file
		puts "resolv_file value has 0 length"
		return -1
	}

	set ns1 $accounts($list_name,ns1)
	set ns2 $accounts($list_name,ns2)

	puts "Opening resolv_file $resolv_file"
	if { [catch { set resolv_fd [open $resolv_file w] } err] != 0 } {
		puts "Unable to create $resolv_file: $err"
		return -1
	}
	puts $resolv_fd "# resolv.conf file generated by ppptool"
	set search_list {}

	set domain $accounts($list_name,domain)

	# only add search if we have a domain
	if { [string length $domain] > $domain_len } {
		puts $resolv_fd "domain $domain"
		lappend search_list $domain 

		foreach item $accounts($list_name,search) {
			if { [lsearch -exact $search_list $item] == -1 } {
				lappend search_list $item 
			}
		}
		if { [llength $search_list] < 1 } {
				puts $resolv_fd "search $domain"
		} else {
				puts $resolv_fd "search $search_list"
		}
	} 
	

	if { [info exists ns1] && [string length $ns1] >= $ipaddr_len } {
		puts $resolv_fd "nameserver $ns1"
	}
	if { [info exists ns2] && [string length $ns2] >= $ipaddr_len } {
		puts $resolv_fd "nameserver $ns2"
	}
	close $resolv_fd
	puts "Created resolv_file $resolv_file"
	exec chown $env(USER_ID) $resolv_file

	return 0

}


